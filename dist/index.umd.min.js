!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).EventBus=n()}(this,function(){"use strict";var r=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")};function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e};function s(e){return"[object String]"==Object.prototype.toString.call(e)}var a=function(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e};function c(e){var n=e.split(".");return{name:e[0],namespaceList:n.slice(1).sort()}}function o(e){return RegExp("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)")}function l(e){var n=[],t="string"==typeof e?[s(s)?e:e+""]:e;return t.forEach(function(e){n.push(c(e))}),n}var e=function(){function e(){r(this,e),a(this,"entries",{})}return t(e,[{key:"on",value:function(e,i,n){var r=this,s=2<arguments.length&&void 0!==n&&n;return e?(l(e).forEach(function(e){var n,t;e.name&&((t=e.name)in(n=r.entries)||(n[t]=new u(t)),n[t]).addCallback(e.namespaceList,i,s)}),this):null}},{key:"once",value:function(e,n){return this.on(e,n,!0)}},{key:"off",value:function(e,t){var i=this;if(e)return l(e).forEach(function(n){var e;n.name?(e=i.entries[n.name])&&e.removeCallback(n.namespaceList,t):n.namespaceList&&Object.keys(i.entries).forEach(function(e){i.entries[e].removeCallback(n.namespaceList,t)})}),this;this.entries={}}},{key:"trigger",value:function(e){if(e){var n=c(e);if(n.name){var t=this.entries[n.name];if(t){for(var i=arguments.length,r=Array(1<i?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];t.fire.apply(t,[n.namespaceList].concat(r))}return this}}}}]),e}(),u=function(){function n(e){r(this,n),a(this,"_listeners",void 0),a(this,"_name",void 0),this._name=e}return t(n,[{key:"addCallback",value:function(e,n,t){var i=2<arguments.length&&void 0!==t&&t;this.listeners.unshift(new f(n,e.join("."),i))}},{key:"removeCallback",value:function(e,n){for(var t=e.length&&o(e),i=this.listeners.length-1;0<=i;i--)t&&!t.test(this.listeners[i].namespaces)||n&&this.listeners[i].callback!==n||this.listeners.splice(i,1)}},{key:"fire",value:function(e){for(var n=e.length&&o(e),t=arguments.length,i=Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(var s,a=this.listeners.length-1;0<=a;a--){n&&!n.test(this.listeners[a].namespaces)||((s=this.listeners[a]).callback.apply(s,i),this.listeners[a].once&&this.listeners.splice(a,1))}}},{key:"listeners",get:function(){return void 0===this._listeners&&(this._listeners=[]),this._listeners}},{key:"name",get:function(){return this._name}}]),n}(),f=function(){function i(e,n,t){r(this,i),a(this,"_callback",void 0),a(this,"_once",void 0),a(this,"_namespaces",void 0),this._callback=e,this._once=t,this._namespaces=n}return t(i,[{key:"callback",get:function(){return this._callback}},{key:"once",get:function(){return this._once}},{key:"namespaces",get:function(){return this._namespaces}}]),i}();return e});
