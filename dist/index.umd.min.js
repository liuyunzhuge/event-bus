!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).EventBus=t()}(this,function(){"use strict";var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};var a=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var o=function(e){if(Array.isArray(e))return e};var l=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}};var s=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};function c(e){return"[object String]"==Object.prototype.toString.call(e)}var u=function(e,t){return o(e)||l(e,t)||s()};function f(e){return{name:(e=e.split("."))[0],namespaceList:e.slice(1).sort()}}function h(e){return RegExp("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)")}function v(e){"[object Array]"!=Object.prototype.toString.call(e)&&(e=[c(c)?e:e+""]);var t=!0,n=!1,r=void 0;try{for(var i,a=e.entries()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=u(i.value,2);e[o[0]]=f(o[1])}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e}function y(e,t){return e.has(t)?e.get(t):null}var e=function(){function e(){i(this,e),a(this,"entries",new Map)}return n(e,[{key:"on",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;if(e){e=v(e);var i,a,o,l=!0,s=!1,c=void 0;try{for(var u,f=e[Symbol.iterator]();!(l=(u=f.next()).done);l=!0){var h=u.value;(o=void 0,o=null,(i=this.entries).has(a=h.name)?o=i.get(a):(o=new p(a),i.set(a,o)),o).addCallback(h.namespaceList,t,r)}}catch(e){s=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(s)throw c}}return this}}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"off",value:function(e,t){var n,r;if(1===arguments.length?n=0<arguments.length?e:void 0:2==arguments.length&&(n=0<arguments.length?e:void 0,r=1<arguments.length?t:void 0),!n)return this.entries.clear();n=v(n);var i=!0,a=!1,o=void 0;try{for(var l,s=n[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value,u=y(this.entries,c.name);u&&u.removeCallback(c.namespaceList,r)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return this}},{key:"trigger",value:function(e){if(e){e=f(e);var t=y(this.entries,e.name);if(t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.fire.apply(t,[e.namespaceList].concat(r))}return this}}}]),e}(),p=function(){function t(e){i(this,t),a(this,"_listeners",void 0),a(this,"_name",void 0),this._name=e}return n(t,[{key:"addCallback",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;this.listeners.push(new d(t,e.join("."),r))}},{key:"removeCallback",value:function(e,t){for(var n=e.length&&h(e),r=this.listeners.length-1;0<=r;r--)n&&!n.test(this.listeners[r].namespaces)||t&&this.listeners[r].callback!==t||this.listeners.splice(r,1)}},{key:"fire",value:function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=[],a=e.length&&h(e);if(this.listeners.forEach(function(e,t){a&&!a.test(e.namespaces)||(e.callback.apply(e,n),e.once&&i.push(t))}),i.length)for(var o=0,l=0,s=i;l<s.length;l++){this.listeners.splice(s[l]-o,1),o+=1}}},{key:"listeners",get:function(){return void 0===this._listeners&&(this._listeners=[]),this._listeners}},{key:"name",get:function(){return this._name}}]),t}(),d=function(){function r(e,t,n){i(this,r),a(this,"_callback",void 0),a(this,"_once",void 0),a(this,"_namespaces",void 0),this._callback=e,this._once=n,this._namespaces=t}return n(r,[{key:"callback",get:function(){return this._callback}},{key:"once",get:function(){return this._once}},{key:"namespaces",get:function(){return this._namespaces}}]),r}();return e});
